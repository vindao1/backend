<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>WhatsApp Panel</title>
    <style>
        /* (Tambahkan CSS Anda di sini) */
        #export-button {
            margin-top: 10px;
            background-color: #1D6F42;
            color: white;
            padding: 10px 15px;
            border: none;
            cursor: pointer;
        }
        #export-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>Panel Pengiriman Pesan</h1>
    
    <hr>
    
    <h2>Log Aktivitas</h2>
    <button id="export-button" disabled>Ekspor Log ke Excel</button>
    <div id="log-container" style="height: 200px; overflow-y: scroll; border: 1px solid #ccc; padding: 5px; margin-top: 10px;"></div>

    <script>
        const socket = new WebSocket('ws://82.153.226.19/ws'); // Ganti dengan alamat Anda
        const logContainer = document.getElementById('log-container');
        const exportButton = document.getElementById('export-button');
        let mySessionId = null;

        socket.onopen = function() {
            logContainer.innerHTML += '<div>Koneksi ke server berhasil.</div>';
        };

        socket.onmessage = function(event) {
            const message = JSON.parse(event.data);

            if (message.type === 'session_created') {
                mySessionId = message.sessionId;
                console.log('Sesi saya adalah:', mySessionId);
            }

            if (message.type === 'log') {
                logContainer.innerHTML += `<div>${message.data}</div>`;
                logContainer.scrollTop = logContainer.scrollHeight; // Auto-scroll
                
                // Aktifkan tombol ekspor jika sudah ada log
                if (logContainer.children.length > 1) {
                    exportButton.disabled = false;
                }
            }

            if (message.type === 'excel_ready') {
                logContainer.innerHTML += `<div>Laporan Excel siap. <a href="${message.data.url}" target="_blank" download>Unduh di sini</a></div>`;
                exportButton.disabled = false;
                exportButton.innerText = 'Ekspor Log ke Excel';
            }
            
            // (Tambahkan logika lain untuk QR, status, dll.)
        };

        exportButton.onclick = function() {
            if (!mySessionId) {
                alert('Sesi belum siap.');
                return;
            }
            
            exportButton.disabled = true;
            exportButton.innerText = 'Membuat Laporan...';

            const payload = {
                sessionId: mySessionId,
                type: 'export_excel'
            };
            socket.send(JSON.stringify(payload));
        };
    </script>
</body>
</html>